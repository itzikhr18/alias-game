<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üé≤ ◊ê◊ú◊ô◊ê◊° - ◊û◊©◊ó◊ß ◊û◊ô◊ú◊ô◊ù</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 16px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 24px;
    }
    
    .header h1 {
      font-size: 36px;
      margin-bottom: 8px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .card {
      background: white;
      border-radius: 20px;
      padding: 32px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    
    .card h2 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #333;
      text-align: center;
    }
    
    .alert {
      background: #fef2f2;
      border: 2px solid #ef4444;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      color: #991b1b;
      font-size: 14px;
    }
    
    .alert.success {
      background: #f0fdf4;
      border-color: #10b981;
      color: #065f46;
    }
    
    .alert.warning {
      background: #fffbeb;
      border-color: #f59e0b;
      color: #92400e;
    }
    
    .alert strong {
      display: block;
      margin-bottom: 4px;
    }
    
    .join-options {
      display: grid;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .option-card {
      border: 3px solid #e5e7eb;
      border-radius: 16px;
      padding: 24px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .option-card:hover {
      border-color: #667eea;
      background: #f9fafb;
    }
    
    .option-card.selected {
      border-color: #667eea;
      background: linear-gradient(135deg, #667eea10, #764ba210);
    }
    
    .option-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }
    
    .option-title {
      font-size: 20px;
      font-weight: 700;
      color: #333;
      margin-bottom: 8px;
    }
    
    .option-desc {
      font-size: 14px;
      color: #666;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .form-group input {
      width: 100%;
      padding: 14px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 16px;
      transition: border 0.2s;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .room-code-display {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      margin-bottom: 20px;
    }
    
    .room-code-label {
      font-size: 14px;
      color: rgba(0,0,0,0.7);
      margin-bottom: 8px;
    }
    
    .room-code {
      font-size: 48px;
      font-weight: 900;
      color: white;
      letter-spacing: 8px;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    button {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-secondary {
      background: #e5e7eb;
      color: #333;
      margin-top: 12px;
    }
    
    .btn-danger {
      background: #ef4444;
      color: white;
    }
    
    .btn-success {
      background: #10b981;
      color: white;
    }
    
    .players-list {
      margin: 20px 0;
    }
    
    .player-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #f9fafb;
      border-radius: 10px;
      margin-bottom: 8px;
    }
    
    .player-item.me {
      background: linear-gradient(135deg, #667eea20, #764ba220);
      border: 2px solid #667eea;
    }
    
    .player-item.turn {
      background: linear-gradient(135deg, #fbbf2420, #f59e0b20);
      border: 2px solid #f59e0b;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    
    .player-color {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    
    .player-info {
      flex: 1;
    }
    
    .player-name {
      font-weight: 700;
      color: #333;
    }
    
    .player-team {
      font-size: 12px;
      color: #666;
    }
    
    .player-badge {
      padding: 4px 8px;
      background: #667eea;
      color: white;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
    }
    
    .game-board {
      margin: 20px 0;
      background: linear-gradient(135deg, #dc2626, #b91c1c);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .board-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      position: relative;
      width: 100%;
      height: 350px;
      margin-bottom: 16px;
    }
    
    @media (min-width: 768px) {
      .board-grid {
        height: 450px;
      }
      
      .board-space {
        width: 70px;
        height: 70px;
      }
    }
    
    .board-space {
      width: 60px;
      height: 60px;
      border: 3px solid #e5e7eb;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 800;
      color: #666;
      position: absolute;
      background: white;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .board-space.finish {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: white;
      font-size: 14px;
      border-color: #f59e0b;
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
    }
    
    .pawns {
      display: flex;
      gap: 2px;
      position: absolute;
      bottom: 2px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 50px;
      padding: 0 2px;
    }
    
    .pawn {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      animation: popIn 0.3s ease-out;
    }
    
    @keyframes popIn {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    
    .turn-indicator {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      margin-bottom: 20px;
      border: 3px solid #f59e0b;
    }
    
    .turn-indicator.my-turn {
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
      border-color: #10b981;
      animation: glow 2s ease-in-out infinite;
    }
    
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.5); }
      50% { box-shadow: 0 0 40px rgba(16, 185, 129, 0.8); }
    }
    
    .turn-text {
      font-size: 16px;
      color: #666;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .turn-team {
      font-size: 36px;
      font-weight: 900;
      color: #667eea;
      margin-bottom: 8px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    .turn-status {
      font-size: 18px;
      font-weight: 700;
      padding: 8px 16px;
      border-radius: 999px;
      display: inline-block;
      margin-top: 8px;
    }
    
    .turn-status.your-turn {
      background: #10b981;
      color: white;
      animation: pulse 1.5s ease-in-out infinite;
    }
    
    .turn-status.waiting {
      background: #f59e0b;
      color: white;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .timer-section {
      margin-bottom: 20px;
    }
    
    .timer-text {
      text-align: center;
      font-size: 32px;
      font-weight: 900;
      color: #333;
      margin-bottom: 8px;
    }
    
    .timer-bar {
      height: 12px;
      background: #e5e7eb;
      border-radius: 6px;
      overflow: hidden;
    }
    
    .timer-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #22d3ee);
      width: 100%;
      transition: width 1s linear;
    }
    
    .word-display {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border-radius: 20px;
      padding: 60px 24px;
      text-align: center;
      margin-bottom: 24px;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .word-number {
      color: rgba(255,255,255,0.8);
      font-size: 16px;
      margin-bottom: 8px;
    }
    
    .word {
      font-size: 48px;
      font-weight: 900;
      color: white;
      text-shadow: 0 4px 12px rgba(0,0,0,0.2);
      line-height: 1.2;
    }
    
    .word-hint {
      color: rgba(255,255,255,0.9);
      font-size: 14px;
      margin-top: 12px;
    }
    
    .score-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .score-box {
      background: #f9fafb;
      border-radius: 12px;
      padding: 12px;
      text-align: center;
    }
    
    .score-number {
      font-size: 28px;
      font-weight: 900;
    }
    
    .score-label {
      font-size: 11px;
      color: #666;
      margin-top: 4px;
    }
    
    .score-box.correct .score-number { color: #10b981; }
    .score-box.mistake .score-number { color: #ef4444; }
    .score-box.skip .score-number { color: #f59e0b; }
    
    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .btn-correct {
      background: #10b981;
      color: white;
    }
    
    .btn-mistake {
      background: #ef4444;
      color: white;
    }
    
    .btn-skip {
      background: #f59e0b;
      color: white;
    }
    
    .btn-end {
      background: #6b7280;
      color: white;
    }
    
    .instruction {
      text-align: center;
      font-size: 13px;
      color: #666;
      line-height: 1.6;
    }
    
    .kbd {
      display: inline-block;
      background: #f3f4f6;
      border: 2px solid #d1d5db;
      border-radius: 4px;
      padding: 2px 6px;
      font-family: monospace;
      font-size: 11px;
      font-weight: 700;
    }
    
    .waiting-message {
      text-align: center;
      padding: 40px 20px;
      color: #666;
      background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
      border-radius: 16px;
      border: 3px dashed #cbd5e1;
    }
    
    .waiting-icon {
      font-size: 64px;
      margin-bottom: 16px;
      animation: rotate 3s linear infinite;
    }
    
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .winner-display {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      border-radius: 20px;
      padding: 40px 24px;
      text-align: center;
      margin: 20px 0;
    }
    
    .winner-icon {
      font-size: 80px;
      margin-bottom: 16px;
    }
    
    .winner-text {
      font-size: 28px;
      font-weight: 900;
      color: white;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .status-message {
      background: #f0f9ff;
      border: 2px solid #3b82f6;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      color: #1e40af;
      text-align: center;
      font-weight: 600;
    }
    
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üé≤ ◊ê◊ú◊ô◊ê◊°</h1>
      <p>◊û◊©◊ó◊ß ◊û◊®◊ï◊ë◊î ◊û◊©◊™◊û◊©◊ô◊ù ◊¢◊ù Supabase</p>
    </div>
    
    <!-- ◊û◊°◊ö ◊õ◊†◊ô◊°◊î -->
    <div id="loginScreen" class="card">
      <div id="supabaseAlert" class="alert success">
        <strong>‚úÖ Supabase ◊û◊ó◊ï◊ë◊® ◊ï◊û◊ï◊õ◊ü!</strong>
        ◊î◊û◊©◊ó◊ß ◊û◊°◊ï◊†◊õ◊®◊ü ◊ï◊ñ◊û◊ô◊ü ◊ú◊õ◊ú ◊î◊û◊õ◊©◊ô◊®◊ô◊ù üéÆ
      </div>
      
      <h2>üéÆ ◊î◊¶◊ò◊®◊§◊ï◊™ ◊ú◊û◊©◊ó◊ß</h2>
      
      <div class="join-options">
        <div class="option-card" data-option="create">
          <div class="option-icon">üéØ</div>
          <div class="option-title">◊ô◊¶◊ô◊®◊™ ◊ó◊ì◊® ◊ó◊ì◊©</div>
          <div class="option-desc">◊¶◊ï◊® ◊û◊©◊ó◊ß ◊ó◊ì◊© ◊ï◊î◊ñ◊û◊ü ◊ó◊ë◊®◊ô◊ù</div>
        </div>
        
        <div class="option-card" data-option="join">
          <div class="option-icon">üö™</div>
          <div class="option-title">◊î◊¶◊ò◊®◊§◊ï◊™ ◊ú◊ó◊ì◊® ◊ß◊ô◊ô◊ù</div>
          <div class="option-desc">◊î◊õ◊†◊° ◊ß◊ï◊ì ◊ó◊ì◊® ◊ï◊î◊¶◊ò◊®◊£ ◊ú◊û◊©◊ó◊ß</div>
        </div>
      </div>
      
      <div id="createForm" class="hidden">
        <div class="form-group">
          <label>◊î◊©◊ù ◊©◊ú◊ö:</label>
          <input type="text" id="playerNameCreate" placeholder="◊î◊õ◊†◊° ◊©◊ù..." maxlength="20">
        </div>
        <button class="btn-primary" id="createRoomBtn">üéØ ◊¶◊ï◊® ◊ó◊ì◊®</button>
      </div>
      
      <div id="joinForm" class="hidden">
        <div class="form-group">
          <label>◊ß◊ï◊ì ◊ó◊ì◊®:</label>
          <input type="text" id="roomCodeInput" placeholder="ABCD" maxlength="6" style="text-transform: uppercase; text-align: center; letter-spacing: 4px;">
        </div>
        <div class="form-group">
          <label>◊î◊©◊ù ◊©◊ú◊ö:</label>
          <input type="text" id="playerNameJoin" placeholder="◊î◊õ◊†◊° ◊©◊ù..." maxlength="20">
        </div>
        <button class="btn-primary" id="joinRoomBtn">üö™ ◊î◊¶◊ò◊®◊£ ◊ú◊ó◊ì◊®</button>
      </div>
    </div>
    
    <!-- ◊û◊°◊ö ◊î◊û◊™◊†◊î -->
    <div id="lobbyScreen" class="card hidden">
      <div class="room-code-display">
        <div class="room-code-label">◊ß◊ï◊ì ◊î◊ó◊ì◊®:</div>
        <div class="room-code" id="roomCodeDisplay">----</div>
        <div style="margin-top: 12px; font-size: 14px; color: rgba(0,0,0,0.6);">
          ◊©◊™◊£ ◊ê◊™ ◊î◊ß◊ï◊ì ◊¢◊ù ◊ó◊ë◊®◊ô◊ù üì≤
        </div>
      </div>
      
      <h2>üë• ◊©◊ó◊ß◊†◊ô◊ù ◊ë◊ó◊ì◊®</h2>
      <div class="players-list" id="playersList"></div>
      
      <div class="status-message" id="statusMessage">
        ◊û◊ó◊õ◊ô◊ù ◊ú◊¢◊ï◊ì ◊©◊ó◊ß◊†◊ô◊ù... (◊û◊ô◊†◊ô◊û◊ï◊ù 2)
      </div>
      
      <button class="btn-success hidden" id="startGameBtn">üéÆ ◊î◊™◊ó◊ú ◊û◊©◊ó◊ß!</button>
      <button class="btn-danger" id="leaveRoomBtn">üö™ ◊¢◊ñ◊ï◊ë ◊ó◊ì◊®</button>
    </div>
    
    <!-- ◊û◊°◊ö ◊û◊©◊ó◊ß -->
    <div id="gameScreen" class="card hidden">
      <div class="turn-indicator" id="turnIndicator">
        <div class="turn-text">◊™◊ï◊® ◊©◊ú:</div>
        <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
          <div style="font-size: 48px;">üë§</div>
          <div class="turn-team" id="turnTeamName">‚Äî</div>
        </div>
        <div class="turn-status waiting" id="turnStatus">‚è≥ ◊û◊ó◊õ◊ô◊ù...</div>
      </div>
      
      <div class="game-board">
        <div class="board-grid" id="boardGrid"></div>
      </div>
      
      <div id="activePlayArea" class="hidden">
        <button class="btn-success" id="startTurnBtn" style="margin-bottom: 20px;">‚ñ∂Ô∏è ◊î◊™◊ó◊ú ◊™◊ï◊®</button>
        
        <div class="timer-section">
          <div class="timer-text" id="timerText">60</div>
          <div class="timer-bar">
            <div class="timer-fill" id="timerFill"></div>
          </div>
        </div>
        
        <div class="score-row">
          <div class="score-box correct">
            <div class="score-number" id="correctCount">0</div>
            <div class="score-label">‚úÖ ◊†◊õ◊ï◊ü</div>
          </div>
          <div class="score-box mistake">
            <div class="score-number" id="mistakeCount">0</div>
            <div class="score-label">‚ùå ◊ò◊¢◊ï◊™</div>
          </div>
          <div class="score-box skip">
            <div class="score-number" id="skipCount">0</div>
            <div class="score-label">‚è≠Ô∏è ◊ì◊ô◊ú◊ï◊í</div>
          </div>
        </div>
        
        <div class="word-display">
          <div class="word-number" id="wordNumber">◊û◊°◊§◊®: 1</div>
          <div class="word" id="currentWord">◊ú◊ó◊• "◊î◊™◊ó◊ú ◊™◊ï◊®"</div>
          <div class="word-hint">◊ê◊°◊ï◊® ◊ú◊î◊í◊ô◊ì ◊ê◊™ ◊î◊û◊ô◊ú◊î ◊ê◊ï ◊î◊©◊ï◊®◊© ◊©◊ú◊î</div>
        </div>
        
        <div class="action-buttons">
          <button class="btn-correct" id="correctBtn" disabled>‚úÖ<br>◊†◊õ◊ï◊ü</button>
          <button class="btn-mistake" id="mistakeBtn" disabled>‚ùå<br>◊ò◊¢◊ï◊™</button>
          <button class="btn-skip" id="skipBtn" disabled>‚è≠Ô∏è<br>◊ì◊ô◊ú◊ï◊í</button>
        </div>
        
        <button class="btn-end" id="endTurnBtn" disabled>‚èπÔ∏è ◊°◊ô◊ô◊ù ◊™◊ï◊®</button>
        
        <p class="instruction" style="margin-top: 12px;">
          <span class="kbd">Space</span> ◊†◊õ◊ï◊ü ¬∑ <span class="kbd">X</span> ◊ò◊¢◊ï◊™ ¬∑ <span class="kbd">S</span> ◊ì◊ô◊ú◊ï◊í
        </p>
      </div>
      
      <div id="waitingArea" class="waiting-message hidden">
        <div class="waiting-icon">‚è≥</div>
        <div style="font-size: 24px; font-weight: 900; margin-bottom: 16px; color: #f59e0b;">
          ◊ú◊ê ◊î◊™◊ï◊® ◊©◊ú◊ö
        </div>
        <div style="font-size: 16px; margin-bottom: 8px;">
          ◊¶◊§◊î ◊ë◊ú◊ï◊ó ◊ï◊™◊û◊ï◊ö ◊ë◊ß◊ë◊ï◊¶◊î ◊©◊ú◊ö!
        </div>
        <div style="font-size: 14px; color: #999; margin-top: 16px;">
          ◊î◊™◊ï◊® ◊ô◊¢◊ë◊ï◊® ◊ê◊ú◊ô◊ö ◊ë◊ß◊®◊ï◊ë...
        </div>
      </div>
      
      <div id="winnerArea" class="hidden">
        <div class="winner-display">
          <div class="winner-icon">üèÜ</div>
          <div class="winner-text" id="winnerText">‚Äî</div>
        </div>
        <button class="btn-primary" id="newGameBtn">üîÑ ◊û◊©◊ó◊ß ◊ó◊ì◊©</button>
      </div>
    </div>
  </div>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // ===== üî• ◊î◊í◊ì◊®◊ï◊™ Supabase - ◊û◊ó◊ï◊ë◊®! =====
    const SUPABASE_URL = 'https://dlgximvxlqjqnwiopdrl.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZ3hpbXZ4bHFqcW53aW9wZHJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NDgxMzgsImV4cCI6MjA3NTIyNDEzOH0.iFDeeSIUgdKP491zKf-IBh584jlJWmic5OhnycV4Z0o';
    
    // ◊ê◊™◊ó◊ï◊ú Supabase
    let supabase;
    let channel;
    
    try {
      supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
      document.getElementById('supabaseAlert').className = 'alert success';
      document.getElementById('supabaseAlert').innerHTML = '<strong>‚úÖ Supabase ◊û◊ó◊ï◊ë◊®!</strong> ◊î◊û◊©◊ó◊ß ◊û◊ï◊õ◊ü ◊ú◊©◊ô◊û◊ï◊©.';
    } catch (error) {
      console.error('Supabase error:', error);
      document.getElementById('supabaseAlert').innerHTML = '<strong>‚ùå ◊©◊í◊ô◊ê◊™ Supabase!</strong> ◊ë◊ì◊ï◊ß ◊ê◊™ ◊î◊î◊í◊ì◊®◊ï◊™.';
    }
    
    // ===== ◊û◊ê◊í◊® ◊û◊ô◊ú◊ô◊ù =====
    const WORDS = {
      1: ["◊û◊ß◊®◊®","◊©◊û◊©","◊õ◊ë◊ô◊©","◊°◊§◊®◊ô◊ô◊î","◊©◊ï◊ß◊ï◊ú◊ì","◊†◊î◊®","◊ó◊ú◊ï◊ü","◊û◊ò◊®◊ô◊ô◊î","◊û◊¢◊ú◊ô◊™","◊õ◊ú◊ë","◊¢◊ô◊™◊ï◊ü","◊û◊õ◊ï◊†◊ô◊™","◊©◊ï◊ú◊ó◊ü","◊õ◊ô◊°◊ê","◊û◊†◊¢◊ï◊ú"],
      2: ["◊û◊ó◊©◊ë","◊ô◊®◊ó","◊û◊°◊¢◊ì◊î","◊û◊ï◊ñ◊ô◊ê◊ï◊ü","◊ò◊ú◊ï◊ï◊ô◊ñ◊ô◊î","◊¢◊†◊ü","◊§◊ô◊¶◊î","◊û◊ô◊ß◊®◊ï◊§◊ï◊ü","◊ê◊ï◊ñ◊†◊ô◊ï◊™","◊ó◊™◊ï◊ú","◊®◊ì◊ô◊ï","◊í◊ô◊ò◊®◊î","◊™◊ï◊§◊ô◊ù","◊§◊°◊†◊™◊®","◊¶◊ë◊¢"],
      3: ["◊®◊ï◊§◊ê","◊û◊ï◊®◊î","◊ò◊ë◊ó","◊¶◊ú◊ù","◊ê◊ï◊§◊î","◊†◊î◊í ◊û◊ï◊†◊ô◊™","◊õ◊ë◊ê◊ô","◊°◊§◊®","◊û◊¢◊¶◊ë","◊ó◊©◊û◊ú◊ê◊ô","◊©◊ï◊ò◊®","◊©◊ï◊§◊ò","◊¢◊ï◊®◊ö ◊ì◊ô◊ü","◊û◊î◊†◊ì◊°","◊ê◊ì◊®◊ô◊õ◊ú"],
      4: ["◊©◊ì◊î ◊™◊¢◊ï◊§◊î","◊ß◊†◊ô◊ï◊ü","◊ó◊ï◊£ ◊ô◊ù","◊ê◊¶◊ò◊ì◊ô◊ï◊ü","◊í◊©◊®","◊™◊ó◊†◊™ ◊®◊õ◊ë◊™","◊í◊ü ◊ó◊ô◊ï◊™","◊°◊§◊®◊ô◊ô◊î ◊¢◊ô◊®◊ï◊†◊ô◊™","◊û◊¢◊®◊î","◊û◊§◊¢◊ú","◊ë◊ô◊™ ◊°◊§◊®","◊ë◊ô◊™ ◊ó◊ï◊ú◊ô◊ù","◊™◊ó◊†◊™ ◊ì◊ú◊ß","◊ó◊†◊ô◊ï◊ü","◊§◊ê◊®◊ß"],
      5: ["◊§◊ô◊ú","◊†◊û◊®","◊°◊ï◊°","◊ì◊ï◊ú◊§◊ô◊ü","◊í◊≥◊ô◊®◊§◊î","◊§◊ô◊†◊í◊ï◊ï◊ô◊ü","◊©◊ï◊¢◊ú","◊ô◊†◊©◊ï◊£","◊ñ◊ë◊®◊î","◊ß◊ï◊£","◊ê◊®◊ô◊î","◊ì◊ï◊ë","◊ñ◊ê◊ë","◊¶◊ë◊ô","◊†◊©◊®"],
      6: ["◊ú◊®◊ï◊•","◊ú◊©◊ó◊ï◊™","◊ú◊¶◊ó◊ï◊ß","◊ú◊ë◊õ◊ï◊™","◊ú◊ß◊§◊ï◊•","◊ú◊®◊ß◊ï◊ì","◊ú◊©◊ô◊®","◊ú◊ô◊©◊ï◊ü","◊ú◊ê◊õ◊ï◊ú","◊ú◊©◊™◊ï◊™","◊ú◊ß◊®◊ï◊ê","◊ú◊õ◊™◊ï◊ë","◊ú◊¶◊ô◊ô◊®","◊ú◊¶◊ú◊ù","◊ú◊ò◊ô◊ô◊ú"],
      7: ["◊í◊ì◊ï◊ú","◊ß◊ò◊ü","◊û◊î◊ô◊®","◊ê◊ô◊ò◊ô","◊ó◊ù","◊ß◊®","◊©◊û◊ó","◊¢◊¶◊ï◊ë","◊ó◊õ◊ù","◊ò◊ô◊§◊©","◊ó◊ñ◊ß","◊ó◊ú◊©","◊¢◊©◊ô◊®","◊¢◊†◊ô","◊ô◊§◊î"],
      8: ["◊ê◊î◊ë◊î","◊ó◊ï◊§◊©","◊ñ◊û◊ü","◊õ◊°◊£","◊ó◊ú◊ï◊ù","◊©◊ú◊ï◊ù","◊û◊ú◊ó◊û◊î","◊û◊©◊§◊ó◊î","◊ó◊ë◊®","◊¢◊ë◊ï◊ì◊î","◊ë◊ô◊™","◊ì◊®◊ö","◊ê◊û◊™","◊©◊ß◊®","◊ó◊ô◊ô◊ù"]
    };
    
    const TEAM_COLORS = ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'];
    
    // ===== ◊û◊¶◊ë ◊í◊ú◊ï◊ë◊ú◊ô =====
    let myPlayerId = null;
    let myPlayerName = null;
    let currentRoomCode = null;
    let isHost = false;
    let gameState = null;
    let currentWordsList = [];
    let wordIndex = 0;
    let timerInterval = null;
    
    // ===== ◊§◊ï◊†◊ß◊¶◊ô◊ï◊™ ◊¢◊ñ◊® =====
    function generateRoomCode() {
      return Math.random().toString(36).substr(2, 4).toUpperCase();
    }
    
    function show(el) { el.classList.remove('hidden'); }
    function hide(el) { el.classList.add('hidden'); }
    
    // ===== ◊û◊°◊ö ◊õ◊†◊ô◊°◊î =====
    document.querySelectorAll('.option-card').forEach(card => {
      card.addEventListener('click', () => {
        document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        hide(document.getElementById('createForm'));
        hide(document.getElementById('joinForm'));
        if (card.dataset.option === 'create') {
          show(document.getElementById('createForm'));
        } else {
          show(document.getElementById('joinForm'));
        }
      });
    });
    
    document.getElementById('createRoomBtn').addEventListener('click', createRoom);
    document.getElementById('joinRoomBtn').addEventListener('click', joinRoom);
    document.getElementById('leaveRoomBtn').addEventListener('click', leaveRoom);
    document.getElementById('startGameBtn').addEventListener('click', startGame);
    document.getElementById('startTurnBtn').addEventListener('click', () => {
      console.log('üñ±Ô∏è ◊ú◊ó◊¶◊ï ◊¢◊ú "◊î◊™◊ó◊ú ◊™◊ï◊®"');
      startTurn();
    });
    document.getElementById('correctBtn').addEventListener('click', () => {
      console.log('üñ±Ô∏è ◊ú◊ó◊¶◊ï ◊¢◊ú "◊†◊õ◊ï◊ü"');
      handleAction('correct');
    });
    document.getElementById('mistakeBtn').addEventListener('click', () => {
      console.log('üñ±Ô∏è ◊ú◊ó◊¶◊ï ◊¢◊ú "◊ò◊¢◊ï◊™"');
      handleAction('mistake');
    });
    document.getElementById('skipBtn').addEventListener('click', () => {
      console.log('üñ±Ô∏è ◊ú◊ó◊¶◊ï ◊¢◊ú "◊ì◊ô◊ú◊ï◊í"');
      handleAction('skip');
    });
    document.getElementById('endTurnBtn').addEventListener('click', () => {
      console.log('üñ±Ô∏è ◊ú◊ó◊¶◊ï ◊¢◊ú "◊°◊ô◊ô◊ù ◊™◊ï◊®"');
      endTurn();
    });
    document.getElementById('newGameBtn').addEventListener('click', () => location.reload());
    
    async function createRoom() {
      const name = document.getElementById('playerNameCreate').value.trim();
      if (!name) { alert('◊î◊õ◊†◊° ◊©◊ù'); return; }
      
      currentRoomCode = generateRoomCode();
      myPlayerId = 'p_' + Date.now();
      myPlayerName = name;
      isHost = true;
      
      console.log('üéØ ◊ô◊ï◊¶◊® ◊ó◊ì◊® ◊ó◊ì◊©:', currentRoomCode);
      
      gameState = {
        host: myPlayerId,
        status: 'lobby',
        players: {},
        currentTurn: 0,
        turnActive: false,
        turnData: { correct: 0, mistakes: 0, skips: 0, startTime: null }
      };
      
      gameState.players[myPlayerId] = {
        name, teamIndex: 0, color: TEAM_COLORS[0], position: 0, isHost: true
      };
      
      console.log('‚úÖ ◊î◊û◊ê◊®◊ó ◊†◊ï◊°◊£:', myPlayerId, name);
      
      hide(document.getElementById('loginScreen'));
      show(document.getElementById('lobbyScreen'));
      document.getElementById('roomCodeDisplay').textContent = currentRoomCode;
      
      subscribeToRoom();
      updateLobby();
      broadcastState();
    }
    
    async function joinRoom() {
      const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
      const name = document.getElementById('playerNameJoin').value.trim();
      if (!roomCode || !name) { alert('◊î◊õ◊†◊° ◊ß◊ï◊ì ◊ó◊ì◊® ◊ï◊©◊ù'); return; }
      
      currentRoomCode = roomCode;
      myPlayerId = 'p_' + Date.now();
      myPlayerName = name;
      isHost = false;
      
      console.log('üö™ ◊û◊¶◊ò◊®◊£ ◊ú◊ó◊ì◊®:', roomCode, '◊ë◊©◊ù:', name);
      
      hide(document.getElementById('loginScreen'));
      show(document.getElementById('lobbyScreen'));
      document.getElementById('roomCodeDisplay').textContent = roomCode;
      
      subscribeToRoom();
      
      // ◊©◊ú◊ó ◊ë◊ß◊©◊™ ◊î◊¶◊ò◊®◊§◊ï◊™
      setTimeout(() => {
        console.log('üì§ ◊©◊ï◊ú◊ó ◊ë◊ß◊©◊™ ◊î◊¶◊ò◊®◊§◊ï◊™...');
        channel.send({
          type: 'broadcast',
          event: 'join-request',
          payload: { playerId: myPlayerId, name }
        });
      }, 500);
    }
    
    function subscribeToRoom() {
      console.log('üìª ◊û◊™◊ó◊ë◊® ◊ú◊ó◊ì◊®:', currentRoomCode);
      
      channel = supabase.channel(`room:${currentRoomCode}`);
      
      channel.on('broadcast', { event: 'game-state' }, ({ payload }) => {
        console.log('üì• ◊î◊™◊ß◊ë◊ú ◊û◊¶◊ë ◊û◊©◊ó◊ß:', {
          status: payload.status,
          players: Object.keys(payload.players).length,
          currentTurn: payload.currentTurn,
          turnActive: payload.turnActive
        });
        gameState = payload;
        updateUI();
      });
      
      channel.on('broadcast', { event: 'join-request' }, ({ payload }) => {
        console.log('üì• ◊î◊™◊ß◊ë◊ú◊î ◊ë◊ß◊©◊™ ◊î◊¶◊ò◊®◊§◊ï◊™:', payload);
        if (isHost && gameState) {
          const playerCount = Object.keys(gameState.players).length;
          gameState.players[payload.playerId] = {
            name: payload.name,
            teamIndex: playerCount % 2,
            color: TEAM_COLORS[playerCount % TEAM_COLORS.length],
            position: 0,
            isHost: false
          };
          console.log('‚úÖ ◊©◊ó◊ß◊ü ◊†◊ï◊°◊£! ◊°◊î"◊õ ◊©◊ó◊ß◊†◊ô◊ù:', Object.keys(gameState.players).length);
          updateLobby();
          broadcastState();
        }
      });
      
      channel.on('broadcast', { event: 'action' }, ({ payload }) => {
        console.log('üé¨ ◊î◊™◊ß◊ë◊ú◊î ◊§◊¢◊ï◊ú◊î:', payload.type, '◊û:', payload.playerId, '◊î◊ê◊ù ◊ê◊†◊ô ◊û◊ê◊®◊ó?', isHost);
        if (isHost && gameState) {
          handleHostAction(payload);
        }
      });
      
      channel.subscribe((status) => {
        console.log('üì° ◊°◊ò◊ò◊ï◊° ◊ó◊ô◊ë◊ï◊®:', status);
        if (status === 'SUBSCRIBED') {
          console.log('‚úÖ ◊û◊ó◊ï◊ë◊® ◊ú◊ó◊ì◊® ◊ë◊î◊¶◊ú◊ó◊î!');
        }
      });
    }
    
    function broadcastState() {
      if (channel && gameState) {
        channel.send({
          type: 'broadcast',
          event: 'game-state',
          payload: gameState
        });
      }
    }
    
    function updateUI() {
      if (!gameState) return;
      
      if (gameState.status === 'lobby') {
        updateLobby();
      } else if (gameState.status === 'playing') {
        updateGame();
      }
    }
    
    function updateLobby() {
      if (!gameState) return;
      
      console.log('üîÑ ◊û◊¢◊ì◊õ◊ü ◊ú◊ï◊ë◊ô. ◊©◊ó◊ß◊†◊ô◊ù:', Object.keys(gameState.players).length);
      
      const list = document.getElementById('playersList');
      list.innerHTML = '';
      
      Object.entries(gameState.players).forEach(([id, p]) => {
        const div = document.createElement('div');
        div.className = 'player-item';
        if (id === myPlayerId) div.classList.add('me');
        div.innerHTML = `
          <div class="player-color" style="background: ${p.color}"></div>
          <div class="player-info">
            <div class="player-name">${p.name}</div>
            <div class="player-team">◊ß◊ë◊ï◊¶◊î ${p.teamIndex + 1}</div>
          </div>
          ${p.isHost ? '<div class="player-badge">◊û◊ê◊®◊ó</div>' : ''}
          ${id === myPlayerId ? '<div class="player-badge" style="background: #10b981">◊ê◊™◊î</div>' : ''}
        `;
        list.appendChild(div);
      });
      
      const count = Object.keys(gameState.players).length;
      document.getElementById('statusMessage').textContent = 
        count >= 2 ? `${count} ◊©◊ó◊ß◊†◊ô◊ù ◊û◊ï◊õ◊†◊ô◊ù!` : '◊û◊ó◊õ◊ô◊ù ◊ú◊¢◊ï◊ì ◊©◊ó◊ß◊†◊ô◊ù...';
      
      const startBtn = document.getElementById('startGameBtn');
      if (isHost && count >= 2) {
        console.log('‚úÖ ◊û◊¶◊ô◊í ◊õ◊§◊™◊ï◊® ◊î◊™◊ó◊ú ◊û◊©◊ó◊ß ◊ú◊û◊ê◊®◊ó');
        show(startBtn);
      } else {
        console.log('‚è∏Ô∏è ◊û◊°◊™◊ô◊® ◊õ◊§◊™◊ï◊® ◊î◊™◊ó◊ú (isHost:', isHost, 'count:', count, ')');
        hide(startBtn);
      }
    }
    
    function startGame() {
      if (!isHost) {
        console.log('‚ö†Ô∏è ◊®◊ß ◊î◊û◊ê◊®◊ó ◊ô◊õ◊ï◊ú ◊ú◊î◊™◊ó◊ô◊ú ◊û◊©◊ó◊ß');
        return;
      }
      
      console.log('üéÆ ◊û◊™◊ó◊ô◊ú ◊û◊©◊ó◊ß!');
      gameState.status = 'playing';
      gameState.currentTurn = 0;
      gameState.turnActive = false;
      
      console.log('üìä ◊û◊¶◊ë ◊û◊©◊ó◊ß ◊î◊™◊ó◊ú◊™◊ô:', {
        status: gameState.status,
        currentTurn: gameState.currentTurn,
        turnActive: gameState.turnActive,
        players: Object.keys(gameState.players).length
      });
      
      hide(document.getElementById('lobbyScreen'));
      show(document.getElementById('gameScreen'));
      createBoard();
      broadcastState();
      
      setTimeout(() => {
        console.log('üîÑ ◊û◊¢◊ì◊õ◊ü UI ◊ê◊ó◊®◊ô ◊î◊™◊ó◊ú◊™ ◊û◊©◊ó◊ß');
        updateGame();
      }, 100);
    }
    
    function createBoard() {
      const grid = document.getElementById('boardGrid');
      grid.innerHTML = '';
      for (let i = 0; i <= 40; i++) {
        const space = document.createElement('div');
        space.className = 'board-space';
        space.dataset.position = i;
        if (i === 40) {
          space.classList.add('finish');
          space.innerHTML = '<div>üèÅ</div><div class="pawns"></div>';
        } else if (i === 0) {
          space.innerHTML = '<div style="font-size:14px">START</div><div class="pawns"></div>';
        } else {
          space.innerHTML = `<div>${((i-1)%8)+1}</div><div class="pawns"></div>`;
        }
        grid.appendChild(space);
      }
    }
    
    function updateGame() {
      if (!gameState) return;
      
      console.log('üéÆ ◊û◊¢◊ì◊õ◊ü ◊û◊°◊ö ◊û◊©◊ó◊ß. Status:', gameState.status);
      
      hide(document.getElementById('lobbyScreen'));
      show(document.getElementById('gameScreen'));
      
      if (document.getElementById('boardGrid').children.length === 0) {
        createBoard();
      }
      
      // ◊¢◊ì◊õ◊ü ◊ú◊ï◊ó
      document.querySelectorAll('.pawns').forEach(p => p.innerHTML = '');
      Object.entries(gameState.players).forEach(([id, p]) => {
        const space = document.querySelector(`[data-position="${p.position}"] .pawns`);
        if (space) {
          const pawn = document.createElement('div');
          pawn.className = 'pawn';
          pawn.style.background = p.color;
          space.appendChild(pawn);
        }
      });
      
      // ◊ñ◊ï◊õ◊î?
      const winner = Object.values(gameState.players).find(p => p.position >= 40);
      if (winner) {
        showWinner(winner.name);
        return;
      }
      
      // ◊™◊ï◊®
      const players = Object.entries(gameState.players);
      const [currentId, currentPlayer] = players[gameState.currentTurn % players.length];
      const isMyTurn = currentId === myPlayerId;
      
      console.log('üë§ ◊™◊ï◊® ◊©◊ú:', currentPlayer.name, '◊î◊ê◊ù ◊ñ◊î ◊î◊™◊ï◊® ◊©◊ú◊ô?', isMyTurn);
      
      // üîß ◊™◊ô◊ß◊ï◊ü: ◊î◊í◊ì◊®◊™ indicator
      const indicator = document.getElementById('turnIndicator');
      
      document.getElementById('turnTeamName').textContent = currentPlayer.name;
      document.getElementById('turnTeamName').style.color = currentPlayer.color;
      
      // ◊¢◊ì◊õ◊ï◊ü ◊®◊©◊ô◊û◊™ ◊©◊ó◊ß◊†◊ô◊ù - ◊î◊ì◊í◊© ◊û◊ô ◊ë◊™◊ï◊®
      const playersInGame = document.createElement('div');
      playersInGame.style.cssText = 'display: flex; gap: 8px; justify-content: center; margin-top: 16px; flex-wrap: wrap;';
      
      Object.entries(gameState.players).forEach(([id, player]) => {
        const isCurrent = id === currentId;
        const badge = document.createElement('div');
        badge.style.cssText = `
          padding: 8px 12px;
          border-radius: 999px;
          font-size: 13px;
          font-weight: 700;
          border: 2px solid ${player.color};
          background: ${isCurrent ? player.color : 'white'};
          color: ${isCurrent ? 'white' : player.color};
          ${isCurrent ? 'animation: pulse 1.5s ease-in-out infinite; box-shadow: 0 4px 12px rgba(0,0,0,0.2);' : ''}
        `;
        badge.textContent = `${player.name}${isCurrent ? ' üéÆ' : ''}`;
        playersInGame.appendChild(badge);
      });
      
      // ◊î◊ï◊°◊£ ◊ê◊™ ◊®◊©◊ô◊û◊™ ◊î◊©◊ó◊ß◊†◊ô◊ù ◊û◊™◊ó◊™ ◊ú◊ê◊ô◊†◊ì◊ô◊ß◊ò◊ï◊®
      const existingList = indicator.querySelector('.players-in-game');
      if (existingList) {
        existingList.remove();
      }
      playersInGame.className = 'players-in-game';
      indicator.appendChild(playersInGame);
      
      const activeArea = document.getElementById('activePlayArea');
      const waitingArea = document.getElementById('waitingArea');
      const turnStatus = document.getElementById('turnStatus');
      
      if (isMyTurn) {
        console.log('‚úÖ ◊ñ◊î ◊î◊™◊ï◊® ◊©◊ú◊ô - ◊û◊¶◊ô◊í ◊ê◊ñ◊ï◊® ◊§◊¢◊ô◊ú');
        indicator.classList.add('my-turn');
        turnStatus.className = 'turn-status your-turn';
        turnStatus.innerHTML = 'üéÆ ◊î◊™◊ï◊® ◊©◊ú◊ö! ◊™◊©◊ó◊ß ◊¢◊õ◊©◊ô◊ï!';
        show(activeArea);
        hide(waitingArea);
        hide(document.getElementById('winnerArea'));
        
        if (gameState.turnActive) {
          enableControls(currentPlayer.position);
        } else {
          disableControls();
        }
      } else {
        console.log('‚è≥ ◊ú◊ê ◊î◊™◊ï◊® ◊©◊ú◊ô - ◊û◊¶◊ô◊í ◊ê◊ñ◊ï◊® ◊î◊û◊™◊†◊î');
        indicator.classList.remove('my-turn');
        turnStatus.className = 'turn-status waiting';
        turnStatus.innerHTML = '‚è≥ ◊û◊ó◊õ◊î ◊ú◊™◊ï◊®...';
        hide(activeArea);
        show(waitingArea);
        hide(document.getElementById('winnerArea'));
      }
      
      // ◊†◊™◊ï◊†◊ô◊ù
      if (gameState.turnData) {
        const correct = gameState.turnData.correct || 0;
        const mistakes = gameState.turnData.mistakes || 0;
        const skips = gameState.turnData.skips || 0;
        
        document.getElementById('correctCount').textContent = correct;
        document.getElementById('mistakeCount').textContent = mistakes;
        document.getElementById('skipCount').textContent = skips;
        
        console.log('üìä ◊†◊ô◊ß◊ï◊ì ◊¢◊ì◊õ◊†◊ô:', { correct, mistakes, skips });
        
        if (gameState.turnActive && gameState.turnData.startTime) {
          const elapsed = Math.floor((Date.now() - gameState.turnData.startTime) / 1000);
          const left = Math.max(0, 60 - elapsed);
          updateTimer(left);
        }
      }
    }
    
    async function startTurn() {
      if (!gameState) {
        console.log('‚ö†Ô∏è ◊ê◊ô◊ü ◊û◊¶◊ë ◊û◊©◊ó◊ß');
        return;
      }
      
      const players = Object.entries(gameState.players);
      const [currentId, p] = players[gameState.currentTurn % players.length];
      
      if (currentId !== myPlayerId) {
        console.log('‚ö†Ô∏è ◊ñ◊î ◊ú◊ê ◊î◊™◊ï◊® ◊©◊ú◊ö!');
        return;
      }
      
      const num = p.position === 0 ? 1 : ((p.position - 1) % 8) + 1;
      
      currentWordsList = [...WORDS[num]].sort(() => Math.random() - 0.5);
      wordIndex = 0;
      
      console.log('‚ñ∂Ô∏è ◊û◊™◊ó◊ô◊ú ◊™◊ï◊®! ◊ß◊ò◊í◊ï◊®◊ô◊î:', num, '◊û◊ê◊®◊ó?', isHost);
      
      await channel.send({
        type: 'broadcast',
        event: 'action',
        payload: { type: 'start-turn', playerId: myPlayerId }
      });
      
      console.log('üì§ ◊†◊©◊ú◊ó start-turn');
      
      if (isHost) {
        console.log('üéØ ◊ê◊†◊ô ◊î◊û◊ê◊®◊ó - ◊û◊¢◊ì◊õ◊ü ◊û◊ô◊ì');
        handleHostAction({ type: 'start-turn', playerId: myPlayerId });
      }
      
      showNextWord(num);
      
      document.getElementById('startTurnBtn').disabled = true;
      document.getElementById('correctBtn').disabled = false;
      document.getElementById('mistakeBtn').disabled = false;
      document.getElementById('skipBtn').disabled = false;
      document.getElementById('endTurnBtn').disabled = false;
    }
    
    function showNextWord(num) {
      if (wordIndex >= currentWordsList.length) {
        wordIndex = 0;
        currentWordsList.sort(() => Math.random() - 0.5);
      }
      document.getElementById('currentWord').textContent = currentWordsList[wordIndex++];
      document.getElementById('wordNumber').textContent = `◊û◊°◊§◊®: ${num}`;
    }
    
    function enableControls(pos) {
      const num = pos === 0 ? 1 : ((pos - 1) % 8) + 1;
      document.getElementById('correctBtn').disabled = false;
      document.getElementById('mistakeBtn').disabled = false;
      document.getElementById('skipBtn').disabled = false;
      document.getElementById('endTurnBtn').disabled = false;
      document.getElementById('startTurnBtn').disabled = true;
      
      document.onkeydown = (e) => {
        if (e.code === 'Space') { e.preventDefault(); handleAction('correct'); }
        else if (e.key === 'x' || e.key === 'X') handleAction('mistake');
        else if (e.key === 's' || e.key === 'S') handleAction('skip');
      };
    }
    
    function disableControls() {
      console.log('üîí ◊û◊õ◊ë◊î ◊õ◊§◊™◊ï◊®◊ô ◊ë◊ß◊®◊î');
      document.getElementById('correctBtn').disabled = true;
      document.getElementById('mistakeBtn').disabled = true;
      document.getElementById('skipBtn').disabled = true;
      document.getElementById('endTurnBtn').disabled = true;
      document.getElementById('startTurnBtn').disabled = false;
      document.getElementById('startTurnBtn').textContent = '‚ñ∂Ô∏è ◊î◊™◊ó◊ú ◊™◊ï◊®';
      
      // üîß ◊™◊ô◊ß◊ï◊ü: ◊ê◊ô◊§◊ï◊° ◊î◊û◊ô◊ú◊î ◊î◊û◊ï◊¶◊í◊™
      document.getElementById('currentWord').textContent = '◊ú◊ó◊• "◊î◊™◊ó◊ú ◊™◊ï◊®"';
      document.getElementById('wordNumber').textContent = '◊û◊°◊§◊®: --';
      
      document.onkeydown = null;
    }
    
    function handleAction(action) {
      if (!gameState || !gameState.turnActive) {
        console.log('‚ö†Ô∏è ◊ú◊ê ◊†◊ô◊™◊ü ◊ú◊ë◊¶◊¢ ◊§◊¢◊ï◊ú◊î - ◊î◊û◊©◊ó◊ß ◊ú◊ê ◊§◊¢◊ô◊ú');
        return;
      }
      
      console.log('üéØ ◊§◊¢◊ï◊ú◊î:', action);
      
      channel.send({
        type: 'broadcast',
        event: 'action',
        payload: { type: action, playerId: myPlayerId }
      });
      
      if (isHost) {
        handleHostAction({ type: action, playerId: myPlayerId });
      }
      
      const players = Object.entries(gameState.players);
      const [_, p] = players[gameState.currentTurn % players.length];
      const num = p.position === 0 ? 1 : ((p.position - 1) % 8) + 1;
      showNextWord(num);
    }
    
    function handleHostAction(payload) {
      if (!isHost || !gameState) {
        console.log('‚ö†Ô∏è ◊®◊ß ◊î◊û◊ê◊®◊ó ◊ô◊õ◊ï◊ú ◊ú◊¢◊ì◊õ◊ü ◊ê◊™ ◊î◊û◊¶◊ë. isHost:', isHost, 'gameState:', !!gameState);
        return;
      }
      
      console.log('üîß ◊î◊û◊ê◊®◊ó ◊û◊¢◊ì◊õ◊ü:', payload.type);
      
      if (payload.type === 'start-turn') {
        console.log('‚è±Ô∏è ◊û◊™◊ó◊ô◊ú ◊ò◊ô◊ô◊û◊®!');
        gameState.turnActive = true;
        gameState.turnData = { correct: 0, mistakes: 0, skips: 0, startTime: Date.now() };
        
        if (timerInterval) {
          console.log('üßπ ◊û◊†◊ß◊î ◊ò◊ô◊ô◊û◊® ◊ß◊ï◊ì◊ù');
          clearInterval(timerInterval);
        }
        
        timerInterval = setInterval(() => {
          if (!gameState.turnActive) {
            console.log('‚èπÔ∏è ◊î◊™◊ï◊® ◊õ◊ë◊® ◊ú◊ê ◊§◊¢◊ô◊ú');
            clearInterval(timerInterval);
            return;
          }
          
          const elapsed = Math.floor((Date.now() - gameState.turnData.startTime) / 1000);
          console.log('‚è±Ô∏è ◊ó◊ú◊§◊ï', elapsed, '◊©◊†◊ô◊ï◊™');
          
          if (elapsed >= 60) {
            console.log('‚è∞ ◊î◊ñ◊û◊ü ◊†◊í◊û◊®!');
            clearInterval(timerInterval);
            endTurnHost();
            return;
          }
          
          broadcastState();
        }, 1000);
        
        console.log('‚úÖ ◊ò◊ô◊ô◊û◊® ◊î◊ï◊§◊¢◊ú!');
        
        // üîß ◊™◊ô◊ß◊ï◊ü: ◊¢◊ì◊õ◊ü UI ◊û◊ô◊ì ◊ê◊ó◊®◊ô ◊î◊™◊ó◊ú◊™ ◊™◊ï◊®
        updateUI();
        
      } else if (payload.type === 'correct') {
        gameState.turnData.correct = (gameState.turnData.correct || 0) + 1;
        console.log('‚úÖ ◊†◊õ◊ï◊ü! ◊°◊î"◊õ:', gameState.turnData.correct);
      } else if (payload.type === 'mistake') {
        gameState.turnData.mistakes = (gameState.turnData.mistakes || 0) + 1;
        console.log('‚ùå ◊ò◊¢◊ï◊™! ◊°◊î"◊õ:', gameState.turnData.mistakes);
      } else if (payload.type === 'skip') {
        gameState.turnData.skips = (gameState.turnData.skips || 0) + 1;
        console.log('‚è≠Ô∏è ◊ì◊ô◊ú◊ï◊í! ◊°◊î"◊õ:', gameState.turnData.skips);
      } else if (payload.type === 'end-turn') {
        console.log('üèÅ ◊û◊°◊ô◊ô◊ù ◊™◊ï◊®');
        endTurnHost();
        return;
      }
      
      console.log('üì° ◊û◊©◊ì◊® ◊û◊¶◊ë ◊û◊¢◊ï◊ì◊õ◊ü');
      broadcastState();
    }
    
    function endTurn() {
      // üîß ◊™◊ô◊ß◊ï◊ü: ◊†◊ô◊ß◊ï◊ô ◊ò◊ô◊ô◊û◊®
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      
      console.log('‚èπÔ∏è ◊û◊°◊ô◊ô◊ù ◊™◊ï◊®');
      channel.send({
        type: 'broadcast',
        event: 'action',
        payload: { type: 'end-turn', playerId: myPlayerId }
      });
      
      if (isHost) {
        handleHostAction({ type: 'end-turn', playerId: myPlayerId });
      }
      
      document.getElementById('currentWord').textContent = '◊ú◊ó◊• "◊î◊™◊ó◊ú ◊™◊ï◊®"';
    }
    
    function endTurnHost() {
      if (!isHost) return;
      
      console.log('üèÅ ◊î◊û◊ê◊®◊ó ◊û◊°◊ô◊ô◊ù ◊™◊ï◊®');
      
      const total = (gameState.turnData.correct || 0) - (gameState.turnData.mistakes || 0) - (gameState.turnData.skips || 0);
      const players = Object.entries(gameState.players);
      const [id, player] = players[gameState.currentTurn % players.length];
      
      console.log('üìä ◊°◊ô◊õ◊ï◊ù ◊™◊ï◊®:', {
        correct: gameState.turnData.correct,
        mistakes: gameState.turnData.mistakes,
        skips: gameState.turnData.skips,
        total: total,
        player: player.name
      });
      
      gameState.players[id].position = Math.max(0, Math.min(40, gameState.players[id].position + total));
      gameState.currentTurn++;
      gameState.turnActive = false;
      gameState.turnData = { correct: 0, mistakes: 0, skips: 0, startTime: null };
      
      if (timerInterval) clearInterval(timerInterval);
      
      // üîß ◊™◊ô◊ß◊ï◊ü: ◊¢◊ì◊õ◊ï◊ü UI ◊ú◊û◊ê◊®◊ó ◊ú◊§◊†◊ô ◊©◊ô◊ì◊ï◊®
      updateUI();
      
      // ◊©◊ì◊® ◊ê◊™ ◊î◊û◊¶◊ë ◊î◊ó◊ì◊© ◊ú◊õ◊ï◊ú◊ù
      broadcastState();
    }
    
    function updateTimer(left) {
      document.getElementById('timerText').textContent = left;
      document.getElementById('timerFill').style.width = (left/60*100) + '%';
    }
    
    function showWinner(name) {
      hide(document.getElementById('activePlayArea'));
      hide(document.getElementById('waitingArea'));
      show(document.getElementById('winnerArea'));
      document.getElementById('winnerText').textContent = `${name} ◊†◊ô◊¶◊ó!`;
    }
    
    function leaveRoom() {
      // üîß ◊™◊ô◊ß◊ï◊ü: ◊†◊ô◊ß◊ï◊ô ◊ò◊ô◊ô◊û◊® ◊ú◊§◊†◊ô ◊ô◊¶◊ô◊ê◊î
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      if (channel) channel.unsubscribe();
      location.reload();
    }
  </script>
</body>
</html>